<html>
<head>
	<title>Investigating missing DOIs</title>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js"></script>
	<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Baloo+Tamma+2:wght@600&display=swap" rel="stylesheet">
	<style>

		span {
			margin-bottom: 50px;
			height: 25px;
			width: 50px;
			display: block;
		}

		table#tab_citing th, table#tab_cited th {
			background-color: white;
			position: sticky;
			top: 0;
		}

		table {border-collapse: initial !important;}

		canvas{
			width:90vw !important;
			margin-left: -8vw;
		}

		#pie_chart {
			-webkit-filter: drop-shadow( 0px 3px 3px rgba(0,0,0,.3) );
			filter: drop-shadow( 0px 3px 3px rgba(0,0,0,.25) );
			margin: auto;
		}

		h1 {
			text-align: center;
			font-family: 'Baloo Tamma 2', cursive;
			font-size: 4.3vw;
			word-spacing: 1vw;
			letter-spacing: 2px;
		}

		h2 { 
			margin: 30px 0 20px 0; 
			padding-top: 7vh;
		}

		#main{
			margin: 40px 80px 40px 80px;
			text-align:justify;
		}
		#button {
		  display: inline-block;
		  background-color: #14141c;
		  width: 50px;
		  height: 50px;
		  text-align: center;
		  border-radius: 4px;
		  position: fixed;
		  bottom: 30px;
		  right: 30px;
		  transition: background-color .3s, 
		    opacity .5s, visibility .5s;
		  opacity: 0;
		  visibility: hidden;
		  z-index: 1000;
		}
		#button::after {
		  content: "\f077";
		  font-family: FontAwesome;
		  font-weight: normal;
		  font-style: normal;
		  font-size: 2em;
		  line-height: 50px;
		  color: #fff;
		}
		#button:hover {
		  cursor: pointer;
		  background-color: #333;
		}
		#button:active {
		  background-color: #555;
		}
		#button.show {
		  opacity: 1;
		  visibility: visible;
		}

		#software-div {
			margin: auto;
			margin-top: 100px;
			margin-bottom: 100px;
			width: fit-content;
		}

		.white-nav {
			color: white !important;
			font-size: 1.35vw;
		}

		footer.text-center {
			background-color: #302B70;
    		color: white;
		}

		footer a {
			color: #dee0e1; 
		}
		div#begin {
		    background-color: #302B70;
		    color: white;
		    height: 100vh;
		}
		div#head-sec {
		    padding-top: 10vh;
		    display: flex;
		    flex-wrap: wrap;
		    height: 80vh;
		    align-content: center;
			align-items: center;
		}
		div#main-text {
			flex: 1;
			padding: 2vw 2vw 2vw 4vw;
		    text-align: justify;
		}
		img {
		    max-width: 50vw;
		    padding: 5vw;
		    margin: auto;
		}
		.p-2{
			text-align: justify;
			padding: 5vw;
		}
		.p-2 p, .p-2 li{
			padding-left: 5vw;
			padding-right: 5vw;
		}
		.p-4 {
		    padding-top: 1.5rem!important;
		    font-size: 13px;
		}
		p.p-text {
		    margin-top: 60px;
		    margin-bottom: 60px;
		}

		#input-p, #input-pp {
			background-image: url('data:image/png;base64,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');
			background-position: 5px center;
			background-size: 1.7em;
			background-repeat: no-repeat;
			margin: auto;
			display: flow-root;
			width:70vw;
			font-size: 16px;
			padding: 12px 20px 12px 40px;
			border: 1px solid #ddd;
			box-shadow: 1px 1px 10px #dfdfdf;
		}

		div#scroll, div#scroll-cited {
			margin: auto;
			overflow-y:scroll;
			width:70vw;
			height:40vh;
			box-shadow: 1px 1px 10px #dfdfdf;
			/*border-radius: 7px;*/
			margin-bottom: 120px;
		}

		@media screen and (min-width: 992px) {
			.navbar-expand-lg .navbar-nav .nav-link {
			    padding-right: 1rem;
			    padding-left: 1rem;
			}
		}
		
		@media screen and (max-width: 600px) {
			img {
			    max-width: 80vw;
			}
			h2 {
			    font-size: 1.4rem;
			}
		}
		@media screen and (max-width: 800px) {
			.flex-row{
				flex-direction: column !important;
			}
			#revert-img{
				text-align: center;
				order: 2;
			}
			#revert-p{
				order: 1;
			}
			img {
		    	max-width: 70vw;
			}
			div.p-2{
				text-align: justify;
			}
			#center-img{
				text-align: center;
			}
		}

	</style>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
	<link href="https://fonts.googleapis.com/css?family=Merriweather:400,900,900i" rel="stylesheet">
</head>
<body>
	<!--navbar-->
	<nav class="navbar navbar-expand-lg navbar-light sticky-top" style="background-color: #302B70;">
	  <a class="navbar-brand white-nav" href="#" style="font-weight: bold;">IMDAP</a>
	  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
	    <span class="navbar-toggler-icon"></span>
	  </button>
	  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
	    <div class="navbar-nav">
	      <a class="nav-item nav-link white-nav" href="#intro">Introduction <span class="sr-only">(current)</span></a>
	      <a class="nav-item nav-link white-nav" href="#q1">Responsible Publishers</a>
	      <a class="nav-item nav-link white-nav" href="#q2">Receiving Publishers</a>
	      <a class="nav-item nav-link white-nav" href="#q3">Now Valid Citations</a>
	      <a class="nav-item nav-link white-nav" href="#conclusion">Conclusions</a>
	      <a class="nav-item nav-link white-nav" href="#about">About</a>
	    </div>
	  </div>
	</nav>
	<!--fine navbar-->
	
	<!-- Back to top button -->
	<a id="button"></a>
	
	<!-- script for jquey for botton sroll up-->
	<script>
		var btn = $('#button');

		$(window).scroll(function() {
		  if ($(window).scrollTop() > 300) {
		    btn.addClass('show');
		  } else {
		    btn.removeClass('show');
		  }
		});

		btn.on('click', function(e) {
		  e.preventDefault();
		  $('html, body').animate({scrollTop:0}, '300');
		});
	</script>
	
	<div id="begin">
		<!-- beginning of main part-->
		<div id="head-sec">
		<div id="main-text">
	<h1>Investigating missing DOIs</h1>
	    <p>The purpose of this work derives from the research questions that have guided it from the very beginning. They concern:

	the identification of the publishers responsible (due to their incorrect metadata sent to Crossref) for the missing citations in COCI;
	the identification of the publishers to which such invalid citations point (i.e. who published the cited articles);
	the number of currently valid citations among those initially invalid according to our input data.</p>
	</div>
	<img src="img/team.png">
	    </div>
		<br>
	    </div>
	
	<!-- beginning of main part-->
	
	<br>

		<span id="intro"></span>
	<div id="main">
		<h2>Introduction</h2>
	</div>

		<!-- <div id="intro-sec">
			<div id="main-text"> -->
	<div class="d-flex flex-row">
		<div class="p-2">
		<p>OpenCitations represents a relevant project inside the Open Science domain, in particular for what concerns the open scholarly citations. Indeed, its capability of conveying a relevant number of (open) citational information allows the creation of a wide net for the scientific community. COCI is the OC's Index of Crossref open DOI-to-DOI citations. All the information collected by OpenCitations and stored in COCI comes from Crossref. However, not all Crossref citations are transferred in COCI: some of them voluntarily, but some others because of technical errors, since their DOI is invalid. Hence, it represents a loss of information not only for OpenCitations but also for the scientific community. Moreover, also the publishers of the article connected to these invalid identifiers are directly affected by this gap from two different perspectives: they can be the direct responsibles for committing the errors which invalidate the DOIs of the cited source, since Crossref does not perform a double-check of the information provided by the publishers; or they can be the publishers of the articles which are wrongly cited and, because of this, they lose all the advantages of being citable (e.g. acknowledgments).</p>

		<p>The purpose of this work derives from the research questions that have guided it from the very beginning. They concern:</p>

		<ul>
			<li>The identification of the publishers responsible (due to their incorrect metadata sent to Crossref) for the missing citations in COCI;</li>
			<li>The identification of the publishers to which such invalid citations point (i.e. who published the cited articles); </li>
			<li>The number of currently valid citations among those initially invalid according to our input data.</li>
		</ul>
		</div>

		<div class="p-2" id="center-img">
		<img src="https://static.vecteezy.com/system/resources/previews/001/869/216/non_2x/people-with-teamwork-icon-design-free-vector.jpg">
		</div>
	</div>

		<br>
		<!-- <div id="intro-sec">-->
	<div class="d-flex flex-row">
		<div class="p-2" id="revert-img">
			<img src="https://static.vecteezy.com/system/resources/previews/001/869/978/non_2x/avatar-men-with-teamwork-icon-design-free-vector.jpg">
		</div>
			<!-- <div id="main-text"> -->
		<div class="p-2" id="revert-p">
		<p>In particular, among the data obtained and collected in the output file, we have selected some more suitable to represent the information found and therefore facilitate its interpretation:</p>
		

		<ul>
			<li>The names and identifiers of the publishers involved in the citations (either as the publishers of the citing DOI or the publisher of the cited DOIs); </li>
			<li>The numbers of the valid and invalid citations they are responsible for as the publishers of the valid citing DOI; </li>
			<li>The number of the valid and invalid citations they are involved in as publishers of the cited DOI;</li>
			<li>The total number of DOIs now valid.</li>
		</ul>

		<p>Based on the research questions and hence on the purpose of the project thus defined, the objective of our work is firstly to identify the main publishers involved in these missing citations; and, secondly, patterns of errors and if they could be attributable to certain activities of some publishers; for instance, if the presence of these incorrect DOIs is to attribute exclusively to the incorrect sending of the citational metadata of the publications by the publisher to Crossref. This objective could be translated into another broader objective of making sure that more data can be integrated into COCI by correcting the activities carried out by the publishers that lead to these missing citations and invalid data; or hypothesize a different method of collecting the citational data from publishers that can prevent the insertion of incorrect citational data in platforms such as Crossref.</p>
		</div>
	</div>

	<div id="main">


		<span id="q1"></span>
	<div>
		<h2>Which publishers were responsible (due to their incorrect metadata sent to Crossref) for the missing citations in COCI?</h2>

		<p class="p-text">explaination of the question and the data</p>

		<input type="text" id="input-p" onkeyup="searchPublisherr()" placeholder="Search for publishers.." title="Type in a name">

		<div id="scroll">
			<table id="tab_citing" class="table">
				<tr>
					<th>publisher</th>
					<th>invalid citing</th>
					<th>valid citing</th>
					<th>total citing</th>
				</tr>
			</table>
		</div>

		<p class="p-text">explaination of the chart</p>

		<div id="container-chartjs">
			<canvas id="bar-chartjs" style="width: 90vw !important; padding-left: 5vw;"></canvas>
		</div>

		<script>
			var data = jQuery.getJSON('output_read_only_new.json', function(json) {
				var keys = [];

				var array_of_dict = []; //data structure for the bar graph

				for (var p in json["publishers"]){ // p è una stringa di un numero
					keys.push([json["publishers"][parseInt(p)]["name"], parseInt(p)]); //p["name"] ? per metterli in ordine alfabetico -- p["name"] è undefined
				}

				var sortedKeys = keys.sort(function (a,b) {
					if (a[0] < b[0]) return -1;
					if (a[0] > b[0]) return 1;
					return 0;
				});

				for(var pub of sortedKeys){
					// console.log(pub);
					var name = pub[0];
					var invalid_citing = json["publishers"][pub[1]]["responsible_for_i"];
					var valid_citing= json["publishers"][pub[1]]["responsible_for_v"];
					var table = document.getElementById("tab_citing");

					// console.log(invalid_citing);

					var row = table.insertRow(-1);
					row.insertCell(0).innerHTML = name;
					row.insertCell(1).innerHTML = invalid_citing;
					row.insertCell(2).innerHTML = valid_citing;
					row.insertCell(3).innerHTML = invalid_citing+valid_citing;

					// has to be 19 in the real world
					if (array_of_dict.length <= 19) {
						array_of_dict.push({
							"publisher": name,
							"invalid_citing": invalid_citing,
							"valid_citing": valid_citing,
							"total": invalid_citing+valid_citing
						});

					}
					else {
						var pos = 0;
						var smallest = array_of_dict[0]["total"];
						for (d of array_of_dict) {
							if (d["total"] < smallest) {
								smallest = d['total'];
								pos = array_of_dict.indexOf(d);
							}
						}
						if (invalid_citing+valid_citing > smallest) {
							array_of_dict[pos]["publisher"] = name;
							array_of_dict[pos]["invalid_citing"] = invalid_citing;
							array_of_dict[pos]["valid_citing"] = valid_citing;
							array_of_dict[pos]["total"] = invalid_citing+valid_citing;
						}

					}

				} // si chiude il for loop

				// sort array of dict in ordine decrescente
				array_of_dict.sort(function(a,b) {
					return b.total - a.total
				});

				const ctx = document.getElementById("bar-chartjs").getContext("2d");

				var valid_cit = array_of_dict.map(function (d) {
					return d.valid_citing;
				});

				var invalid_cit = array_of_dict.map(function (d) {
					return d.invalid_citing;
				});

				var pubs = array_of_dict.map(function (d) {
					return d.publisher;
				});


				var stackedChart = new Chart(ctx, {
					type: 'horizontalBar',
					data: {
						labels: pubs,
						datasets: [
							{
								label: 'invalid citing',
								data: invalid_cit,
								backgroundColor: '#6b5da9' // yellow
							},
							{
								label: 'valid citing', //per noi è invalid o valid
								data: valid_cit, // per noi è il numero, cioè il valore di valid o invalid
								backgroundColor: '#35037a' // green
							}

						],

					},
					options: {
						responsive: true,
						/*maintainAspectRatio:false,*/
						scales: {
							xAxes: [{
								stacked: true,
								ticks: {
									autoSkip: false
								}
							}],
							yAxes: [{
								stacked: true
							}]
						},
			            title: {
			                display: true,
			                text: 'Stacked Bar Chart with invalid and valid citing publishers',
			                fontSize:30
			            }
					},
					/*plugins: [{
					   beforeDraw: function(c) {
					      var chartWidth = c.chart.width;
					      c.scales['y-axis-0'].options.ticks.fontSize = chartWidth * 2 / 100;
					   }
					}]*/
				});

			});

			// search bar

			function searchPublisherr() {
				var input, filter, table, tr, td, i, txtValue;
				input = document.getElementById("input-p");
				filter = input.value.toUpperCase();
				table = document.getElementById("tab_citing");
				tr = table.getElementsByTagName("tr");
				for (i = 0; i < tr.length; i++) {
					td = tr[i].getElementsByTagName("td")[0];
					if (td) {
						txtValue = td.textContent || td.innerText;
						if (txtValue.toUpperCase().indexOf(filter) > -1) {
							tr[i].style.display = "";
						} else {
							tr[i].style.display = "none";
						}
					}
				}
			};


		</script>

	</div>

		<span id="q2"></span>
	<div>
		<h2>To which publishers did such invalid citations point to (i.e. who published the cited articles)?</h2>

		<p class="p-text">explaination of the question and the data</p>

		<input type="text" id="input-pp" onkeyup="searchPublisher()" placeholder="Search for publishers.." title="Type in a name">

		<div id="scroll-cited">
			<table id="tab_cited" class="table">
				<tr>
					<th>publisher</th>
					<th>invalid cited</th>
					<th>valid cited</th>
					<th>total cited</th>
				</tr>
			</table>
		</div>

		<p class="p-text">explaination of the chart</p>

		<div id="container-chartjs-cited">
			<canvas id="bar-chartjs-cited" style="width: 90vw !important; padding-left: 5vw;"></canvas>
		</div>

		<script type="text/javascript">

			var data = jQuery.getJSON('output_read_only_new.json', function(json) {
				var keys = [];

				var array_of_dict = []; //data structure for the bar graph

				for (var p in json["publishers"]){ // p è una stringa di un numero
					keys.push([json["publishers"][parseInt(p)]["name"], parseInt(p)]); //p["name"] ? per metterli in ordine alfabetico -- p["name"] è undefined
				}

				var sortedKeys = keys.sort(function (a,b) {
					if (a[0] < b[0]) return -1;
					if (a[0] > b[0]) return 1;
					return 0;
				});

				for(var pub of sortedKeys){
					// console.log(pub);
					var name = pub[0];
					var invalid_cited = json["publishers"][pub[1]]["receiving_i"];
					var valid_cited = json["publishers"][pub[1]]["receiving_v"];
					var table = document.getElementById("tab_cited");

					var row = table.insertRow(-1);
					row.insertCell(0).innerHTML = name;
					row.insertCell(1).innerHTML = invalid_cited;
					row.insertCell(2).innerHTML = valid_cited;
					row.insertCell(3).innerHTML = invalid_cited+valid_cited;

					// has to be 19 in the real world
					if (array_of_dict.length <= 19) {
						array_of_dict.push({
							"publisher": name,
							"invalid_cited": invalid_cited,
							"valid_cited": valid_cited,
							"total": invalid_cited+valid_cited
						});

					}
					else {
						var pos = 0;
						var smallest = array_of_dict[0]["total"];
						for (d of array_of_dict) {
							if (d["total"] < smallest) {
								smallest = d['total'];
								pos = array_of_dict.indexOf(d);
							}
						}
						if (invalid_cited+valid_cited > smallest) {
							array_of_dict[pos]["publisher"] = name;
							array_of_dict[pos]["invalid_cited"] = invalid_cited;
							array_of_dict[pos]["valid_cited"] = valid_cited;
							array_of_dict[pos]["total"] = invalid_cited+valid_cited;
						}

					}

				} // si chiude il for loop

				// sort array of dict in ordine decrescente
				array_of_dict.sort(function(a,b) {
					return b.total - a.total
				});

				const ctx = document.getElementById("bar-chartjs-cited").getContext("2d");

				var valid_cit = array_of_dict.map(function (d) {
					return d.valid_cited;
				});

				var invalid_cit = array_of_dict.map(function (d) {
					return d.invalid_cited;
				});

				var pubs = array_of_dict.map(function (d) {
					return d.publisher;
				});


				var stackedChart = new Chart(ctx, {
					type: 'horizontalBar',
					data: {
						labels: pubs,
						datasets: [
							{
								label: 'invalid cited',
								data: invalid_cit,
								backgroundColor: 'rgba(75,116,198,0.7)'
							},
							{
								label: 'valid cited', //per noi è invalid o valid
								data: valid_cit, // per noi è il numero, cioè il valore di valid o invalid
								backgroundColor: 'rgba(0,34,100,0.7)'
							}

						],

					},
					options: {
						responsive: true,
						maintainAspectRatio: false,
						scales: {
							xAxes: [{
								stacked: true,
								ticks: {
									autoSkip: false
								}
							}],
							yAxes: [{
								stacked: true
							}]
						},
			            title: {
			                display: true,
			                text: 'Stacked Bar Chart with invalid and valid cited publishers',
			                fontSize:30,
			                paddingBottom:100
			            }
					}
				});

			})


			// search bar

			function searchPublisher() {
				var input, filter, table, tr, td, i, txtValue;
				input = document.getElementById("input-pp");
				filter = input.value.toUpperCase();
				table = document.getElementById("tab_cited");
				tr = table.getElementsByTagName("tr");
				for (i = 0; i < tr.length; i++) {
					td = tr[i].getElementsByTagName("td")[0];
					if (td) {
						txtValue = td.textContent || td.innerText;
						if (txtValue.toUpperCase().indexOf(filter) > -1) {
							tr[i].style.display = "";
						} else {
							tr[i].style.display = "none";
						}
					}
				}
			}

		</script>

	</div>

		<span id="q3"></span>
	<div>
		<h2>How many invalid citations are currently valid?</h2>
		<p class="p-text">Text for the results of the third question</p>
		<div id="pie_chart"></div>

		<script>

			var data = jQuery.getJSON('output_read_only_new.json', function(json) {

				var data = {
					"valid":json["total_num_of_valid_citations"],
					"invalid":json["total_num_of_invalid_citations"]
				};
				var tot_citations=data["valid"]+data["invalid"];
				console.log(tot_citations)

				// set the dimensions and margins of the graph
				var width = 600
				height = 600
				margin = 120

				// The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
				var radius = Math.min(width, height) / 2 - margin

				// append the svg object to the div called 'my_dataviz'
				var svg = d3.select("#pie_chart")
						.append("svg")
						.attr("width", width)
						.attr("height", height)
						.append("g")
						.attr("transform", "translate(" + width / 2 + "," + height / 2.5 + ")");


				// set the color scale
				var color = d3.scaleOrdinal()
						.domain(data)
						.range(["#98abc5", "#a05d56"])


				// Compute the position of each group on the pie:
				var pie = d3.pie()
						.sort(null) // Do not sort group by size
						.value(function(d) {return d.value; })

				var data_ready = pie(d3.entries(data))

				// The arc generator
				var arc = d3.arc()
						.innerRadius(radius * 0.6)         // This is the size of the donut hole
						.outerRadius(radius * 0.8)
						.cornerRadius(3) // sets how rounded the corners are on each slice
						.padAngle(0.015) // effectively dictates the gap between slices

				// Another arc that won't be drawn. Just for labels positioning
				var outerArc = d3.arc()
						.innerRadius(radius * 0.9)
						.outerRadius(radius * 0.9)
						.cornerRadius(3) // sets how rounded the corners are on each slice
						.padAngle(0.015) // effectively dictates the gap between slices





				// Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
				svg
						.selectAll('allSlices')
						.data(data_ready)
						.enter()
						.append('path')
						.attr('d', arc)
						.attr('fill', function(d){ return(color(d.data.key)) })
						.attr("stroke", "white")
						.style("stroke-width", "2px")
						.style("opacity", 0.7)
						.on('mouseover', function (data) {
							svg.append('text')
									.attr('class', 'toolCircle')
									.attr('dy', -15) // hard-coded. can adjust this to adjust text vertical alignment in tooltip
									.html("Citations "+ data.data.key +": "+ data.value) // add text to the circle.
									.style('font-size', '1em')
									.style('text-anchor', 'middle'); // centres text in tooltip

							svg.append('circle')
									.attr('class', 'toolCircle')
									.attr('r', radius-75) // radius of tooltip circle
									.style('fill', color(data.data.key))
									.style('fill-opacity', 0.35);
						})
						.on('mouseout', function () {
							d3.selectAll('.toolCircle').remove();
						});




				// Add the polylines between chart and labels:
				svg
						.selectAll('allPolylines')
						.data(data_ready)
						.enter()
						.append('polyline')
						.attr("stroke", "black")
						.style("fill", "none")
						.attr("stroke-width", 1)
						.attr('points', function(d) {
							var posA = arc.centroid(d) // line insertion in the slice
							var posB = outerArc.centroid(d) // line break: we use the other arc generator that has been built only for that
							var posC = outerArc.centroid(d); // Label position = almost the same as posB
							var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2 // we need the angle to see if the X position will be at the extreme right or extreme left
							posC[0] = radius * 0.95 * (midangle < Math.PI ? 1 : -1); // multiply by 1 or -1 to put it on the right or on the left
							return [posA, posB, posC]
						})

				// Add the polylines between chart and labels:
				svg
						.selectAll('allLabels')
						.data(data_ready)
						.enter()
						.append('text')
						.text( function(d) { console.log(d.data.key+" "+(100*d.data.value/tot_citations + "%")) ; return d.data.key+" "+((100*d.data.value/tot_citations).toFixed(2) + "%") } )
						.attr('transform', function(d) {
							var pos = outerArc.centroid(d);
							var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2
							pos[0] = radius * 0.99 * (midangle < Math.PI ? 1 : -1);
							return 'translate(' + pos + ')';
						})
						.style('text-anchor', function(d) {
							var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2
							return (midangle < Math.PI ? 'start' : 'end')
						})

			});

		</script>


	</div>

		<span id="conclusion"></span>
	<div>
		<h2>Conclusions</h2>
	</div>

		<span id="about"></span>
	<div>
		<h2>About</h2>
		<div class="card-deck">
			  <div class="card">
			    <img class="card-img-top" src="img/alessia_img.jpeg" alt="Card image cap">
			    <div class="card-body">
			      <h5 class="card-title">Alessia Cioffi</h5>
			      <p class="card-text">Graduated in Classical Literature at the University of Bologna. I'm currently attending the Digital Humanities and Digital Knowledge Master Degree course at the same University.</p>
			    </div>
			    <div class="card-footer">
			      <small class="text-muted">alessia.cioffi@studio.unibo.it</small>
			    </div>
			  </div>
			  <div class="card">
			    <img class="card-img-top" src="img/arianna_img.jpeg" alt="Card image cap">
			    <div class="card-body">
			      <h5 class="card-title">Arianna Moretti</h5>
			      <p class="card-text">Graduated in Anthropology at the University of Bologna. I'm currently attending the Digital Humanities and Digital Knowledge Master Degree course at the same University.</p>
			    </div>
			    <div class="card-footer">
			      <small class="text-muted">arianna.moretti2@studio.unibo.it</small>
			    </div>
			  </div>
			  <div class="card">
			    <img class="card-img-top" src="img/nooshin_img.jpg" alt="Card image cap">
			    <div class="card-body">
			      <h5 class="card-title">Nooshin Shahidzadeh Asadi</h5>
			      <p class="card-text">Graduated in software engineering at the University of Tehran. I'm currently attending the Digital Humanities and Digital Knowledge Master Degree course at the University of Bologna.</p>
			    </div>
			    <div class="card-footer">
			      <small class="text-muted">noo.shahidzadehasadi@studio.unibo.it</small>
			    </div>
			  </div>
			<div class="card">
			    <img class="card-img-top" src="img/sara_img.jpeg" alt="Card image cap">
			    <div class="card-body">
			      <h5 class="card-title">Sara Coppini</h5>
			      <p class="card-text">Graduated in Philosophy at the University of Bologna. I'm currently attending the Digital Humanities and Digital Knowledge Master Degree course at the same University.</p>
			    </div>
			    <div class="card-footer">
			      <small class="text-muted">sara.coppini@studio.unibo.it</small>
			    </div>
			  </div>
		</div>

	</div>

	</div>
	<!-- closing main div -->
	
	<!--Link to the software -->
	<div id="software-div">
		<button type="button" class="btn btn-secondary btn-lg">THE SOFTWARE</button>
	</div>

	  <!-- Footer -->
	<footer class="text-center text-lg-start">
  <!-- Grid container -->
  <div class="container p-4">
    <!--Grid row-->
    <div class="row">
      <!--Grid column-->
      <div class="col-lg-6 col-md-12 mb-4 mb-md-0">
        <h5 class="text-uppercase">Credits</h5>

        <p>
          LIBRERIE JS
          LIBRERIE BOOTSTRAP
        </p>
      </div>
      <!--Grid column-->

      <!--Grid column-->
      <div class="col-lg-6 col-md-12 mb-4 mb-md-0">
        <h5 class="text-uppercase">Useful links</h5>
	      <ul style="list-style: none; padding: 0;">
        	<li><a href="">Article</a></li>
        	<li><a href="https://doi.org/10.5281/zenodo.4671486">DMP</a></li>
        	<li><a href="https://dx.doi.org/10.17504/protocols.io.buhjnt4n">Protocol</a></li>
        	<li><a href="https://github.com/open-sci/2020-2021">GitHub repo</a></li>
	      </ul>
      </div>
      <!--Grid column-->
    </div>
    <!--Grid row-->
  </div>
  <!-- Grid container -->

	<div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2); padding-bottom: 0px !important; font-size: 12px;">
	    Created for the final project of the <a href="https://www.unibo.it/en/teaching/course-unit-catalogue/course-unit/2020/443753">Open Science course</a> at the <a href="https://www.unibo.it/en">University of Bologna</a>.
	</div>

  <!-- Copyright -->
  <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2); font-size: 12px;">
    © 2021 Copyright:
    <a href="https://orcid.org/0000-0002-9812-4065">Alessia Cioffi</a>, 
    <a href="https://orcid.org/0000-0001-5486-7070">Arianna Moretti</a>, 
    <a href="https://orcid.org/0000-0003-4114-074X">Nooshin Shahidzadeh Asadi</a>, 
    <a href="https://orcid.org/0000-0002-6279-3830">Sara Coppini</a>
  </div>
  <!-- Copyright -->
</footer>
	  <!-- Footer -->
</body>
</html>
